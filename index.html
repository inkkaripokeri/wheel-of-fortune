<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">


  <title>Onnenpy√∂r√§</title>
  <style>
    /* Comic Neue Regular */
    @font-face {
    font-family: 'ComicNeue';
    src: url('fonts/ComicNeue-Regular.woff2') format('woff2'),
        url('fonts/ComicNeue-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
    }

    /* Comic Neue Bold */
    @font-face {
    font-family: 'ComicNeue';
    src: url('fonts/ComicNeue-Bold.woff2') format('woff2'),
        url('fonts/ComicNeue-Bold.woff') format('woff');
    font-weight: 700;
    font-style: normal;
    }

    @font-face {
    font-family: 'Digital7';
    src: url('fonts/digital-7-mono.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
    }

    /*
    html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'ComicNeue', sans-serif;
    background-image: url('background.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    justify-content: center;
    align-items: center;
    }
    */

    html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    font-family: 'ComicNeue', sans-serif;

    /* background-image: url('background.png'); */
    background-image: url('background-green.webp');
    background-size: cover;        /* ‚≠ê t√§ytt√§√§ koko ikkunan */
    background-position: center;   /* ‚≠ê keskitt√§√§ */
    background-repeat: no-repeat;  /* ‚≠ê ei toista */
    background-attachment: fixed;  /* ‚≠ê pysyy paikallaan scrollissa */
    }


    .container {
      text-align: center;
    }

    h1 {
      font-size: 48px;
      margin-bottom: 30px;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
    }

    h2 {
      font-size: 28px;
      margin-top: 30px;
      margin-bottom: 10px;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
    }

    .row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .input-short {
      width: 20ch;
      height: 40px;
      text-align: center;
      background-color: white;
      border: 3px solid #444;
      border-radius: 4px;
      font-size: 18px;
      font-family: 'ComicNeue', sans-serif;
      text-transform: uppercase;
    }

    .input-long {
     
      text-align: center;
      background-color: white;
      border: 3px solid #444;
      border-radius: 4px;
      font-size: 18px;
      font-family: 'ComicNeue', sans-serif;
      text-transform: uppercase;
      resize: none;
      width: 20ch;
      line-height: 1.2;
      height: 4lh;
    }


    #playButton {
      margin-top: 30px;
      padding: 10px 30px;
      font-size: 20px;
      background-color: #ffcc00;
      border: 3px solid #444;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Pelin√§kym√§ */
    #gameView {
      /* display: none; */
      width: 100%;
      padding: 40px;
      box-sizing: border-box;
      position: relative;
    }

    #gameView.active {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: visible; 
    }


    #gameLayout {
    flex: 1;            /* üî• t√§m√§ tekee taian */
    display: flex;
    gap: 60px;
    justify-content: center;
    align-items: center; /* flex-start ‚Üí center */
    overflow: visible;
    }


    /* ‚≠ê Aihe sanataulun yl√§puolella */
    #topicTitle {
      text-align: center;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
      font-size: 32px;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }


    #leftSide {
        display: flex;
        flex-direction: column;
        align-items: flex-start; /* ‚Üê nyt aihe tasataan vasemmalle */
        height: 100%; /* ‚≠ê t√§m√§ antaa onnenpy√∂r√§lle vertailukorkeuden */
    }

.player.activePlayer {
    background-color: #F2A43C;
    border: 3px solid #C27820;
    box-shadow: 0 0 14px rgba(255, 204, 0, 0);
    animation: pulseActive 1.2s ease-in-out infinite;
    transform: scale(1.05); /* 5 % isompi */
    z-index: 2; /* ettei leikkaudu */
}

.player.activePlayer .playerName {
    color: #333333;
    font-weight: 700;
    text-shadow: 0 0 6px rgba(120, 120, 120, 0);
}

@keyframes pulseActive {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.02); }
    100% { transform: scale(1); }
}

.player.activePlayer.winGold {
    background-color: #FFD700 !important;
    border-color: #B8860B !important;
    animation: pulseGold 1.0s ease-in-out infinite;
}

@keyframes pulseGold {
    0%   { transform: scale(1.05); }
    50%  { transform: scale(1.20); } /* isompi pulssi */
    100% { transform: scale(1.05); }
}




/* Pelaajapalkki */
#playerBar {
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 80px;
  margin-bottom: 80px;
  position: relative;           /* varmistaa, ett√§ ::before toimii oikein */
}

.player {
    background-color: #b8b8b8;
    border: 3px solid #474747;
    padding: 10px 20px;
    border-radius: 10px;
    transition: transform 0.25s ease;
}


/* Pelaajan nimi */
.playerName {
  font-size: 26px;
  color: #333333;
  font-weight: 700;
  text-shadow: 0 0 6px rgba(120, 120, 120, 0);
}

/* Pelaajan pistelaskuri */
.playerScore {
  width: 180px;
  height: 60px;
  background-color: black;
  color: #ffcc00;
  font-family: 'Digital7', monospace;
  font-size: 55px;
  text-align: right;
  padding-right: 20px;
  display: flex;
  margin-bottom: 20px;
  margin-top: 20px;
  margin-left: 20px;
  margin-right: 20px;
  align-items: center;
  justify-content: flex-end;
  border: 3px solid #444;
  border-radius: 6px;
}


#wheelWrapper {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
}

#wheelArea {
    position: relative;
    max-height: 70vh;   /* py√∂r√§ saa olla enint√§√§n 70 % selainikkunan korkeudesta */
    max-width: 60vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

#wheelImage {
    max-height: 100%;
    max-width: 100%;
    height: auto;
    width: auto;
    object-fit: contain;
}

/* PNG-nuoli */
#wheelPointer {
  position: absolute;
  top: -40px;              /* s√§√§d√§ nuolen paikkaa */
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  pointer-events: none;
}

#wheelPointer img {
  width: 40px;             /* ‚≠ê nuolen koko ‚Äî s√§√§d√§ vapaasti */
  height: auto;
  display: block;
}


#wordGrid {
  --wordgrid-width: 780px;   /* ‚≠ê nyt actionButtons n√§kee t√§m√§n */
  width: var(--wordgrid-width);
  margin: 0 auto;            /* ‚≠ê keskitys */
}

#wordGrid .grid {
  display: grid;
  grid-template-columns: repeat(13, 55px);
  grid-template-rows: repeat(4, 75px);
  gap: 4px;
}



/* Ulkokuori ‚Äì punainen borderi pysyy paikallaan */
.cell {
  width: 55px;
  height: 75px;
  border: 4px solid red;
  border-radius: 0px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden; /* t√§rke√§, ettei fill vuoda ulos */
}

/* Sisus ‚Äì piilotettu kirjain ennen paljastusta */
.cell .fill {
  width: 100%;
  height: 100%;
  background: #003366; /* piilotettu tausta */
  display: flex;
  justify-content: center;
  align-items: center;

  font-family: Arial, sans-serif;
  font-size: 50px;

  /* Piilotetaan kirjain aluksi */
  color: transparent;

  /* Flipin vaatimat 3D-asetukset */
  transform-style: preserve-3d;
  backface-visibility: hidden;
  transform-origin: center;

  transition: background 0.25s ease;
}

/* Kun kirjain on paljastettu flipin j√§lkeen */
.cell .fill.revealed {
  color: #003366; /* tai musta, riippuen taustasta */
  font-size: 50px;
}

/* Flip-animaatio */
.cell .fill.flip {
  animation: flipReveal 0.696s ease-in-out forwards;
}

@keyframes flipReveal {
  0%   { transform: rotateY(0deg); }
  50%  { transform: rotateY(90deg); }
  100% { transform: rotateY(0deg); }
}

#actionButtons {
    width: var(--wordgrid-width);   /* ‚≠ê nyt t√§m√§ toimii oikein */
    margin: 20px auto 0 auto;       /* ‚≠ê sama keskityslogiikka */
    display: flex;
    gap: 10px;
    align-items: stretch;
    justify-content: space-between;
}




.actionBtn {
    flex: 1 1 0;
    min-width: 0;

    white-space: normal;
    word-break: break-word;
    line-height: 1.2;

    max-width: 160px;
    min-height: 70px;

    padding: 10px 20px;
    font-size: 20px;
    background-color: #ffcc00;
    border: 3px solid #444;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'ComicNeue', sans-serif;
    text-transform: uppercase;
    transition: transform 0.1s ease;
}







.actionBtn:hover {
  transform: scale(1.05);
}

.actionBtn:active {
  transform: scale(0.95);
}

.spin-animation {
  transition: transform 2s cubic-bezier(0.1, 0.1, 0.1, 1);
}

.hidden {
  display: none !important;
}

#spinButton { 
    position: relative; 
}

/* Popupin ulkokuori */
#letterPopup {
  position: static;               /* ‚≠ê ei kellu, vaan on normaalissa flowssa */
  width: var(--wordgrid-width);   /* ‚≠ê sama leveys kuin sanataululla */
  margin: 15px auto 0 auto;       /* ‚≠ê keskitys nappirivin alle */

  background: #FB7B32;
  border: 4px solid #444444;
  border-radius: 12px;

  padding: 12px;
  box-sizing: border-box;

  display: none;                  /* ‚≠ê piilotettu oletuksena */
}

/* Otsikko ylh√§√§ll√§ */
#popupTitle {
  margin: 0;
  font-size: 22px;
  font-weight: bold;
  white-space: nowrap; /* ettei otsikko rivity */
}


/* Input ja OK vierekk√§in */
.popupRow {
  display: flex;
  align-items: center;   /* ‚≠ê keskitt√§√§ rivin sis√§ll√§ */
  gap: 15px;
}



.popupContent {
  display: flex;              /* ‚≠ê tekee sis√§ll√∂st√§ flex-kontin */
  align-items: center;        /* ‚≠ê keskitt√§√§ pystysuunnassa */
  justify-content: center;    /* ‚≠ê keskitt√§√§ vaakasuunnassa */
  flex-direction: row;        /* ‚≠ê kaikki yhdelle riville */

  width: 100%;
  font-family: 'ComicNeue', sans-serif;

  transform: scale(0);
  opacity: 0;
}




/* Animaatio ennallaan */
@keyframes popupGrow {
  0%   { transform: scale(0); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

/* Input-kentt√§ */
#consonantInput {
  width: 60px;
  height: 50px;
  font-size: 28px;
  text-align: center;
  border: 3px solid #c9a400;
  border-radius: 6px;
  font-family: 'ComicNeue', sans-serif;
  text-transform: uppercase;
  background: white;
}

/* OK-nappi ‚Äì sama tyyli kuin toimintonapeilla */
#popupOkButton {
  padding: 10px 20px;
  font-size: 20px;
  background: #FFCC02;
  border: 3px solid #444444;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'ComicNeue', sans-serif;
  text-transform: uppercase;
  transition: transform 0.1s ease;
}

#popupOkButton:hover {
  transform: scale(1.05);
}

#popupOkButton:active {
  transform: scale(0.95);
}

#popupPoints {
  font-size: 18px;
}


#debugPoints {
  margin-top: 15px;
  text-align: center;
  font-size: 18px;
  color: #fff;
  text-shadow: 2px 2px 4px #000;
  opacity: 0.8;
  font-family: 'ComicNeue', sans-serif;
}

.solutionButtons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}




#victoryScreen {
    position: fixed;
    inset: 0; /* t√§m√§ korvaa top/left/width/height */
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
}


/* Kun ruutu n√§ytet√§√§n */
#victoryScreen:not(.hidden) {
    opacity: 1;
    pointer-events: auto;
}

#victoryScreen.hidden {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
}


.victoryTitle {
    font-size: 48px;
    font-weight: 900;
    color: gold;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    margin-bottom: 20px;
}

/* Podium container */
#podiumContainer {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 40px;
    width: 100%;
    max-width: 1200px;
}

/* Each podium column */
.podium {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

/* Player name */
.podiumName {
    font-size: 40px;
    font-weight: 700;
    margin-bottom: 4px;
    color: white;
}

/* Player score */
.podiumScore {
    font-size: 24px;
    margin-bottom: 10px;
    opacity: 0.9;
    color: white;
}

/* Podium blocks */
.podiumBlock {
    width: 200px;
    border-radius: 6px 6px 0 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 70px;
    font-weight: 900;
    color: white;
    text-shadow: 0 0 10px rgba(0,0,0,0.4);
}

/* Heights */
.podium1 {
    height: 200px;
    background: linear-gradient(180deg, gold, goldenrod);
}

.podium2 {
    height: 150px;
    background: linear-gradient(180deg, silver, #b0b0b0);
}

.podium3 {
    height: 120px;
    background: linear-gradient(180deg, #cd7f32, #8b4513);
}

/* Positioning */
.first  { order: 2; }
.second { order: 1; }
.third  { order: 3; }

/* Fade-in animation */
@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to   { opacity: 1; transform: scale(1); }
}


.hidden {
    display: none !important;
}

.confettiPiece {
    position: fixed;
    top: -10px;
    width: 10px;
    height: 14px;
    background-color: hsl(calc(360 * var(--hue)), 80%, 60%);
    animation: fall linear forwards;
    z-index: 2147483647; /* maksimi */
}



@keyframes fall {
    to {
        transform: translateY(110vh) rotate(720deg);
    }
}

.playerBox.winPulse {
    animation: winPulseAnim 0.5s ease-out;
}

@keyframes winPulseAnim {
    0%   { transform: scale(1); box-shadow: 0 0 0px gold; }
    50%  { transform: scale(1.15); box-shadow: 0 0 20px gold; }
    100% { transform: scale(1); box-shadow: 0 0 0px gold; }
}

.playerTotalScore {
    font-family: 'ComicNeue', sans-serif;
    font-size: 20px;              /* pienempi kuin nimi */
    color: #333333;               /* ‚≠ê uusi v√§ri */
    text-align: right;            /* tasattu oikealle */
    padding-right: 20px;          /* sama linja kuin playerScore */
    margin-top: -12px;             /* nostaa l√§hemm√§s teht√§v√§pisteit√§ */
    min-height: 24px;             /* pit√§√§ laatikon tasakorkuisena */
}

#letterHelperPanel {
    display: grid;
    grid-template-columns: 1fr 1fr;   /* kaksi saraketta */
    gap: 40px;                        /* v√§li sarakkeiden v√§liin */
    margin-top: 40px;                 /* v√§li sanataulun ja paneelin v√§liin */
    justify-items: center;
}

.letterGroup {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

/* Otsikot ‚Äì pelkk√§√§ teksti√§ */
.letterGroupTitle {
    font-family: inherit;
    font-size: 30px;
    font-weight: 900;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: default;
}

/* Kirjainrivit ‚Äì pelkk√§√§ teksti√§ */
.letterList {
    font-family: inherit;
    font-size: 20px;
    font-weight: 800;
    color: #333;
    text-align: center;
    line-height: 1.6;
    letter-spacing: 3px;
    cursor: default;
}

/* Keskitt√§√§ koko rivin */
.toggleRow {
  display: flex;
  justify-content: center;
  margin-top: 20px; /* s√§√§d√§ tarvittaessa */
  margin-bottom: 30px;
}

/* Toggle container */
.toggle {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  user-select: none;
}

/* Boldattu teksti vasemmalle */
.toggle .labelText {
  font-size: 1.5rem;
  font-weight: bold;
}

/* Piilotetaan checkbox */
.toggle input {
  display: none;
}

/* Sliderin tausta + musta border */
.toggle .slider {
  width: 50px;
  height: 26px;
  background: #bbb;
  border-radius: 30px;
  border: 2px solid black;
  position: relative;
  transition: background 0.3s ease;
}

/* Liukuva pallo */
.toggle .slider::before {
  content: "";
  position: absolute;
  width: 22px;
  height: 22px;
  background: white;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: transform 0.3s ease;
}

/* Kun toggle on p√§√§ll√§ */
.toggle input:checked + .slider {
  background: #4caf50;
}

.toggle input:checked + .slider::before {
  transform: translateX(24px);
}

#introScreen {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  color: white;
  display: none; /* piilossa aluksi */
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 9999;
  font-size: 2rem;
  text-align: center;
}

#introScreen.active {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: visible; 
    }

#introScreen .introContent {
  animation: fadeIn 0.6s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}

.introPlayBtn {
  margin-top: 20px;
  padding: 12px 28px;
  font-size: 1.4rem;
  font-weight: bold;
  border: 2px solid white;
  background: transparent;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s ease;
}

.introPlayBtn:hover {
  background: white;
  color: black;
}


/* Intro-animaation n√§kym√§ */
#introAnimationView {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    gap: 4vmin;
    margin-top: 4vmin;

    /* ‚≠ê Skaalaa koko intro ruudun mukaan */
    transform: scale(1);
    transform-origin: top center;
}

/* Rivi 10 solua */
.introLetterRow {
    display: flex;
    gap: 0;
}

/* ‚≠ê Solujen koko skaalautuu ruudun mukaan */
.introLetterCell {
    width: 10vmin;
    height: 12vmin;
    background: #009CFF;
    outline: 0.6vmin solid #FF0000;
    box-sizing: border-box;
    display: block;
    margin-left: -0.6vmin;
}

.introLetterCell:first-child {
    margin-left: 0;
}

@keyframes flashGrey {
    0%   { background: #00346B; }
    50%  { background: #777777; }
    100% { background: #00346B; }
}

.introLetterCell .fill.flash {
    animation: flashGrey 0.25s ease;
}

/* ‚≠ê Poistetaan px-versio kokonaan ja k√§ytet√§√§n vain vmin */
.introLetterCell {
    border: 0.4vmin solid red;
    margin-right: 0.8vmin;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.introLetterCell:last-child { 
    margin-right: 0; 
}

.introLetterCell .fill {
    width: 100%;
    height: 100%;
    background: #003366;
    display: flex;
    justify-content: center;
    align-items: center;

    /* ‚≠ê Fontti skaalautuu ruudun mukaan */
    font-family: Arial, sans-serif;
    font-size: 9vmin;
    font-weight: bold;

    color: transparent;

    transform-style: preserve-3d;
    backface-visibility: hidden;
    transform-origin: center;

    transition: background 0.25s ease;
}

.introLetterCell .fill.revealed {
    color: #003366;
    background: white;
}

.introLetterCell .fill.flip {
    animation: flipReveal 0.696s ease-in-out forwards;
}

@keyframes flipReveal {
    0%   { transform: rotateY(0deg); }
    50%  { transform: rotateY(90deg); }
    100% { transform: rotateY(0deg); }
}

.introBounce {
    animation: introRowBounce 0.5s ease-out;
}

@keyframes introRowBounce {
    0%   { transform: translateY(0); }
    30%  { transform: translateY(-2vmin); }
    60%  { transform: translateY(0.8vmin); }
    100% { transform: translateY(0); }
}

/* ‚≠ê Py√∂r√§ skaalautuu ruudun mukaan */
#introWheel {
    width: 70vmin;
    height: auto;
    transform-origin: center center;
    transform: scale(0.1);
    opacity: 0;
    transition: transform 1.2s ease-out, opacity 1.2s ease-out;
}

#introWheel.animate {
    transform: scale(1);
    opacity: 1;
}

@keyframes wheelSpin {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

#wheelInner.wheelSpinning {
    animation: wheelSpin 1.2s linear infinite;
}


#introAnimationView {
    display: none;/* flex; tai block */
    transform: translateY(0);
    opacity: 1;
    transition: transform 0.8s ease, opacity 0.8s ease;
}


#introAnimationView.slideOut {
    transform: translateY(-100vh);
    opacity: 0;
}


/* GameView tulee alhaalta sis√§√§n */
#gameView {
    display: block; /* tai flex */
    transform: translateY(100vh);
    opacity: 0;
    transition: transform 0.8s ease, opacity 0.8s ease;
}


#gameView.slideIn {
    transform: translateY(0);
    opacity: 1;
}

/* Koko ruudun overlay */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.75);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

/* Sis√§lt√∂laatikko */
.overlay-content {
  background: #ffffff;
  color: #000;
  width: 80%;
  max-width: 700px;
  max-height: 80vh;
  overflow-y: auto;
  padding: 30px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
}

/* Sulkunappi */
.close-overlay {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #ff4444;
  color: #fff;
  border: none;
  font-size: 24px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
}

  </style>
</head>
<body>

    <!-- Alustuksen√§kym√§ -->
    <div id="setupView" class="container">
            <h1>Onnenpy√∂r√§</h1>

            <h2>Pelaajat</h2>
            <div class="row">
            <input id="player1" class="input-short" maxlength="20" placeholder="Pelaaja 1">
            <input id="player2" class="input-short" maxlength="20" placeholder="Pelaaja 2">
            <input id="player3" class="input-short" maxlength="20" placeholder="Pelaaja 3">
            </div>

            <h2>Teht√§v√§t</h2>
            <div class="row">
            <input id="topic1" class="input-short" maxlength="20" placeholder="Aihe 1">
            <input id="topic2" class="input-short" maxlength="20" placeholder="Aihe 2">
            <input id="topic3" class="input-short" maxlength="20" placeholder="Aihe 3">
            </div>

            <div class="row">
            <textarea id="answer1" class="input-long" maxlength="52" placeholder="Vastaus 1"></textarea>
            <textarea id="answer2" class="input-long" maxlength="52" placeholder="Vastaus 2"></textarea>
            <textarea id="answer3" class="input-long" maxlength="52" placeholder="Vastaus 3"></textarea>
            </div>

            <h3>
                Teht√§v√§ kirjoitetaan yhteen tekstikentt√§√§n, joka sis√§lt√§√§ nelj√§ rivi√§. <br>
                Rivin vaihto tehd√§√§n painamalla Enter. Jokaisella rivill√§ voi olla enint√§√§n 13 merkki√§. <br>
                Kaikki merkit lasketaan mukaan: kirjaimet, numerot, v√§lily√∂nnit ja erikoismerkit.<br>
                Rivien ei tarvitse olla t√§ynn√§, mutta yksik√§√§n rivi ei saa ylitt√§√§ merkkirajaa.
            </h3>

            <div class="toggleRow">
                <label class="toggle">
                    <span class="labelText">N√ÑYT√Ñ ALKUTUNNARI</span>
                    <input type="checkbox" id="showIntro">
                    <span class="slider"></span>
                </label>
            </div>
             

            <button class="actionBtn" id="aloitaButton">ALOITA</button>
    </div>

    <!-- introStartScreen -->
    <div id="introScreen">
        <button id="introPlayButton" class="introPlayBtn"> PLAY </button>
    </div>
    
    <div id="introAnimationView">
        <div class="introLetterRow">
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>
            <div class="introLetterCell">
                <div class="fill"></div>
            </div>            
        </div>
        

        <img id="introWheel" src="onnenpyora.png" alt="Onnenpy√∂r√§">
    </div>
    

    <!-- Pelin√§kym√§ -->
    <div id="gameView">

        <!-- ‚≠ê PELAAJAPALKIN LIS√ÑYS T√ÑH√ÑN -->
        <div id="playerBar">

            <div class="player">
                <div class="playerInner">
                    <div class="playerName" id="p1name"></div>
                    <div class="playerScore" id="p1score">0</div>
        
                    <!-- ‚≠ê KOKO PELIN PISTEET -->
                    <div class="playerTotalScore" id="p1total"></div>
                </div>
            </div>
        
            <div class="player">
                <div class="playerInner">
                    <div class="playerName" id="p2name"></div>
                    <div class="playerScore" id="p2score">0</div>
        
                    <!-- ‚≠ê KOKO PELIN PISTEET -->
                    <div class="playerTotalScore" id="p2total"></div>
                </div>
            </div>
        
            <div class="player">
                <div class="playerInner">
                    <div class="playerName" id="p3name"></div>
                    <div class="playerScore" id="p3score">0</div>
        
                    <!-- ‚≠ê KOKO PELIN PISTEET -->
                    <div class="playerTotalScore" id="p3total"></div>
                </div>
            </div>
        
        </div>

<!-- OHJEET OVERLAY -->
<div id="instructionsOverlay" class="overlay">
  <div class="overlay-content">
    <button class="close-overlay" id="closeInstructions">√ó</button>


    <h3>PELIN TAVOITE</h3>
    <p>Ker√§√§ pisteit√§ oikeista konsonanteista ja arvaa piilotettu lause ennen muita pelaajia.</p>

    <h3>Onnenpy√∂r√§n py√∂ritt√§minen</h3>
    <ul>
      <li>Voit py√∂ritt√§√§ onnenpy√∂r√§√§ omalla vuorollasi.</li>
      <li>Ohi sektorista vuoro siirtyy seuraavalle</li>
      <li>Rosvosektorista pelaaja menett√§√§ teht√§v√§ss√§ ker√§tyt pisteet ja vuoro siirtyy seuraavalle</li>
      <li>Jos py√∂r√§ pys√§htyy pistesektoriin, saat sen osoittaman pistem√§√§r√§n kerrottuna sill√§, montako kertaa valitsemasi konsonantti esiintyy teht√§v√§ss√§.</li>
      <li>Vuoro siirtyy seuraavalle pelaajalle, jos valitsemaasi konsonanttia ei l√∂ydy teht√§v√§st√§.</li>
    </ul>

    <h3>Vokaalien ostaminen</h3>
    <p>Vokaalin voi ostaa 300:lla pisteell√§. Vokaalista ei saa pisteit√§, mutta se auttaa ratkaisussa. Jos vokaalia ei l√∂ydy teht√§v√§st√§, niin vuoro siirtyy seuraavalle. Vokaalia ei voi ostaa kahta kertaa per√§kk√§in samalla vuorolla.</p>

    <h3>Teht√§v√§n ratkaiseminen</h3>
    <p>Voit yritt√§√§ ratkaista teht√§v√§n omalla vuorollasi. Oikea ratkaisu p√§√§tt√§√§ kierroksen, v√§√§r√§ siirt√§√§ vuoron eteenp√§in. Teht√§v√§n ratkaissut pelaaja saa kierroksen aikana ker√§√§m√§ns√§ pisteet kokonaispisteisiins√§.</p>

    <h3>Pelin voittaminen</h3>
    <p>Koko pelin voittaa pelaaja, jolla on eniten kokonaispisteit√§ kolmen teht√§v√§n j√§lkeen.</p>

    <h3>Vinkkej√§ pelaamiseen</h3>
    <p>Arvaa ensin yleisi√§ konsonantteja (S, T, N, R‚Ä¶).</p>
    <p>Kerryt√§ pisteit√§ varmoilla konsonanteilla ennen ratkaisua ‚Äî n√§in saat enemm√§n kokonaispisteit√§ koko pelin voittoa ajatellen.</p>
  </div>
</div>

  
        <!-- ‚≠ê LIS√ÑYS P√Ñ√ÑTTYY -->
        <div id="gameLayout">
            <!-- ‚≠ê Vasemman puolen kontti -->
            <div id="leftSide">
                <div id="topicTitle"></div>
                <div id="wordGrid">
                    <div class="grid">
                        <!-- Rivi 1 -->
                        <div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div>
                        <!-- Rivi 2 -->
                        <div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div>
                        <!-- Rivi 3 -->
                        <div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div>
                        <!-- Rivi 4 -->
                        <div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div><div class="cell"><div class="fill"></div></div>
                    </div>
                </div>

                <div id="actionButtons">
                    <button class="actionBtn" id="spinButton">Py√∂rit√§</button>
                    <button class="actionBtn" id="buyVowelButton">Osta vokaali</button>                
                    <button class="actionBtn" id="solveButton">Ratkaise teht√§v√§</button>
                    <button class="actionBtn" id="endTurnButton">Vuoron vaihto</button>
                    <button class="actionBtn" id="instructionsButton">OHJEET</button>
                </div>

                <!-- Popup pysyy actionButtonsin ulkopuolella -->
                <div id="letterPopup" class="hidden">
                    <div class="popupContent">
                        <div class="popupRow">
                            <p id="popupTitle">Sy√∂t√§ konsonantti:</p>
                            <input id="consonantInput" maxlength="1">
                            <button id="popupOkButton">OK</button>
                        </div>
                    </div>
                </div>
                


            </div>
            <div id="wheelWrapper">

                <div id="wheelArea">
                    <img id="wheelImage" src="onnenpyora.png">

                </div>
            
                <div id="wheelPointer">
                    <img src="pointer.png">
                </div>
            
            </div>
             
        </div>
    </div>


    <div id="victoryScreen" class="hidden">

        <h1 class="victoryTitle">VOITTAJA!</h1>
    
        <div id="podiumContainer">
    
            <!-- 2. sija (vasen) -->
            <div class="podium second">
                <div class="podiumName" id="podiumSecondName"></div>
                <div class="podiumScore" id="podiumSecondScore"></div>
                <div class="podiumBlock podium2">2</div>
            </div>
    
            <!-- 1. sija (keskell√§) -->
            <div class="podium first">
                <div class="podiumName" id="podiumFirstName"></div>
                <div class="podiumScore" id="podiumFirstScore"></div>
                <div class="podiumBlock podium1">1</div>
            </div>
    
            <!-- 3. sija (oikea) -->
            <div class="podium third">
                <div class="podiumName" id="podiumThirdName"></div>
                <div class="podiumScore" id="podiumThirdScore"></div>
                <div class="podiumBlock podium3">3</div>
            </div>
    
        </div>
    </div>
    
    

  <script>
    let players = [];
    let topics = [];
    let answers = [];
    let isBuyingVowel = false;

    let taskScores = [0, 0, 0];  // Pelaajien koko pelin pisteet
    let totalScores = [0, 0, 0];  // Pelaajien koko pelin pisteet

    let currentTaskIndex = 0;   // 0 = teht√§v√§ 1, 1 = teht√§v√§ 2, 2 = teht√§v√§ 3

    //OHJEET

    const instructionsButton = document.getElementById("instructionsButton");
    const instructionsOverlay = document.getElementById("instructionsOverlay");
    const closeInstructions = document.getElementById("closeInstructions");

    // Avaa overlay
    instructionsButton.addEventListener("click", () => {
    instructionsOverlay.style.display = "flex";
    });

    // Sulje overlay ruksista
    closeInstructions.addEventListener("click", () => {
    instructionsOverlay.style.display = "none";
    });

    // Sulje overlay klikkaamalla taustaa
    instructionsOverlay.addEventListener("click", (e) => {
    if (e.target === instructionsOverlay) {
        instructionsOverlay.style.display = "none";
    }
    });



    //Tallennetaan alkudemo asetus
    const showIntro = document.getElementById('showIntro').checked;

    // ALOITA-nappi
    document.getElementById('aloitaButton').addEventListener('click', function () {

        const showIntro = document.getElementById('showIntro').checked;

        if (showIntro) {
            showIntroScreen();   // N√§yt√§ intro + PLAY-nappi
        } else {
            startGameNow();      // Suoraan peliin
        }
    });


    // 1) N√§yt√§ introScreen ja PLAY-nappi
    function showIntroScreen() {

        // Piilota asetussivu
        document.getElementById('setupView').style.display = 'none';

        // N√§yt√§ introScreen
        const intro = document.getElementById('introScreen');
        intro.classList.add('active');

        // PLAY-nappi k√§ynnist√§√§ animaation
        document.getElementById('introPlayButton').onclick = () => {
            playIntroAnimation();
        };
    }


    // 2) PLAY ‚Üí piilota intro ja aloita animaatio
    function playIntroAnimation() {

        // Piilota PLAY-nappi ja tekstit
        document.querySelector('#introScreen .introPlayBtn').style.display = 'none';

        // Poista musta tausta
        document.getElementById('introScreen').classList.remove('active');

        // N√§yt√§ animaation√§kym√§
        document.getElementById('introAnimationView').style.display = 'flex';

        victorySound.currentTime = 0;
        victorySound.play();

        setTimeout(() => {
            stopWheelSpin();
            document.getElementById('introAnimationView').style.display = 'none';
            startGameNow(); 

        }, 22000); 

        // ‚≠ê K√§ynnist√§ py√∂r√§n skaalausanimaatio 
        const wheel = document.getElementById('introWheel'); 
        requestAnimationFrame(() => { 
            wheel.classList.add('animate');
            
            flashCellsSequence();

            setTimeout(() => {
                wheel.style.transition = "none";
                startWheelSpin();
            }, 1200);    
        });


    }

    let wheelRotation = 0;
    let wheelSpinning = false;

function startWheelSpin() {
    const wheel = document.getElementById("introWheel");
    wheelSpinning = true;
    rotateWheel();
}

function stopWheelSpin() {
    wheelSpinning = false;
}

function rotateWheel() {
    if (!wheelSpinning) return;

    wheelRotation += 1; // ‚≠ê py√∂rimisnopeus (asteina per frame)
    const wheel = document.getElementById("introWheel");

    wheel.style.transform = `rotate(${wheelRotation}deg)`; 

    requestAnimationFrame(rotateWheel);
}



    function flashCellsSequence() {

                const cells = Array.from(
                    document.querySelectorAll('#introAnimationView .introLetterCell')
                );

                // ============================
                // 1) V√ÑL√ÑHDYS VASEMMALTA OIKEALLE
                // ============================

                let index = 0;

                const forward = setInterval(() => {

                    if (index >= cells.length) {
                        clearInterval(forward);
                        startBackwardFlash();
                        return;
                    }

                    const currentIndex = index;
                    const fill = cells[currentIndex].querySelector('.fill'); // ‚≠ê t√§rke√§

                    fill.classList.add('flash');
                    setTimeout(() => fill.classList.remove('flash'), 250);

                    index++;

                }, 120);


                // ============================
                // 2) V√ÑL√ÑHDYS OIKEALTA VASEMMALLE
                // ============================

                function startBackwardFlash() {

                    let backIndex = cells.length - 1;
                    
                    const backward = setInterval(() => {

                        if (backIndex < 0) {
                            clearInterval(backward);
                            fadeToGreyLeftToRight();
                            return;
                        }

                        const currentBackIndex = backIndex;
                        const fill = cells[currentBackIndex].querySelector('.fill'); // ‚≠ê t√§rke√§

                        fill.classList.add('flash');
                        setTimeout(() => fill.classList.remove('flash'), 250);

                        backIndex--;

                    }, 120);
                }


                // ============================
                // 3) SOLUJEN HARMAANTUMINEN VASEMMALTA OIKEALLE
                // ============================

                function fadeToGreyLeftToRight() {

                    let greyIndex = 0;

                    const greyer = setInterval(() => {

                        if (greyIndex >= cells.length) {
                            clearInterval(greyer);
                            flipIntroCellsRandom(); // ‚≠ê flip alkaa vasta kun kaikki harmaita
                            return;
                        }

                        const fill = cells[greyIndex].querySelector('.fill'); // ‚≠ê t√§rke√§
                        fill.style.backgroundColor = '#777777';

                        greyIndex++;

                    }, 120);
                }
        }


        function flipIntroCellsRandom() {

            const cells = Array.from(
                document.querySelectorAll('#introAnimationView .introLetterCell')
            );

            const letters = ["O","N","N","E","N","P","Y","√ñ","R","√Ñ"];
            const flipDuration = 696;

            const order = [...Array(cells.length).keys()]
                .sort(() => Math.random() - 0.5);

            order.forEach((cellIndex, i) => {

                const cell = cells[cellIndex];
                const fill = cell.querySelector(".fill");

                setTimeout(() => {

                    // ‚≠ê Nollataan harmaannus
                    fill.style.backgroundColor = "#003366";
                    fill.style.color = "transparent";

                    // Aloita flip
                    fill.classList.add("flip");

                    // ‚≠ê Flipin puoliv√§liss√§ paljastetaan kirjain
                    setTimeout(() => {
                        fill.textContent = letters[cellIndex];
                        fill.classList.add("revealed");

                        // ‚≠ê T√§ss√§ kohtaa tausta muuttuu valkoiseksi
                        fill.style.backgroundColor = "white";
                        fill.style.color = "#003366";
                    }, flipDuration / 2);

                    // Poista flip-luokka lopuksi
                    setTimeout(() => {
                        fill.classList.remove("flip");

                        // ‚≠ê Kun viimeinen kirjain on flipattu ‚Üí bounce koko riville 
                        if (i === order.length - 1) { 
                            const row = document.querySelector('#introAnimationView .introLetterRow'); 
                            row.classList.add('introBounce'); 
                            
                            // Poistetaan luokka, jotta animaatio voi toistua my√∂hemmin 
                            setTimeout(() => row.classList.remove('introBounce'), 600); 
                        }

                    }, flipDuration);

                }, i * flipDuration);
            });
        }






    //showVictoryScreen(); //Testi victoryScreenille

    document.getElementById("endTurnButton").addEventListener("click", function () {
        switchToNextPlayer();
    });

    function switchToNextPlayer() {
        console.log("Siirret√§√§n vuoro seuraavalle.");
        playNotFoundDing();
        nextPlayer();
        resetWheel();
    }


    // ‚≠ê Erikoismerkit, jotka n√§ytet√§√§n heti (ei piiloteta)
    const autoRevealChars = "-&/!?.,:;()";
    
    function startGameNow() {

        players = [
            document.getElementById('player1').value.trim() || "Pelaaja 1",
            document.getElementById('player2').value.trim() || "Pelaaja 2",
            document.getElementById('player3').value.trim() || "Pelaaja 3"
        ];


        // Aihelistat
        topics = [
            document.getElementById('topic1').value.trim(),
            document.getElementById('topic2').value.trim(),
            document.getElementById('topic3').value.trim()
        ];

        // Vastaukset
        answers = [
            document.getElementById('answer1').value,
            document.getElementById('answer2').value,
            document.getElementById('answer3').value
        ];

        // N√§kym√§n vaihto
        //document.getElementById('setupView').style.display = 'none';
        //document.getElementById('gameView').classList.add('active');

        document.getElementById('setupView').style.display = 'none';
        document.getElementById('introAnimationView').classList.add('slideOut'); 
        document.getElementById('gameView').classList.add('slideIn');

        // Pelaajien nimet UI:hin
        document.getElementById("p1name").textContent = players[0].toUpperCase();
        document.getElementById("p2name").textContent = players[1].toUpperCase();
        document.getElementById("p3name").textContent = players[2].toUpperCase();

        // ‚≠ê Teht√§v√§ 1 alkaa
        currentTaskIndex = 0;

        // Pelaaja 1 aloittaa
        setActivePlayer(0);

        // ‚≠ê Lataa teht√§v√§ 1 sanatauluun
        startNewTask();
    }



    

    //Osta vokaali napin handleri
    document.getElementById("buyVowelButton").addEventListener("click", () => {
    const activePlayerIndex = getActivePlayerIndex();
    const scoreElement = document.getElementById(`p${activePlayerIndex + 1}score`);
    const currentScore = parseInt(scoreElement.textContent, 10) || 0;

    if (currentScore < 300) {
        alert("Sinulla ei ole tarpeeksi pisteit√§ vokaalin ostoon!");
        return;
    }
    isBuyingVowel = true;
    document.getElementById("popupTitle").textContent = "VOKAALI";

    const popup = document.getElementById("letterPopup");
    const content = document.querySelector(".popupContent");

    popup.classList.remove("hidden");
    popup.style.display = "flex";
    content.style.pointerEvents = "auto";

    const input = document.getElementById("consonantInput");
    input.value = "";
    setTimeout(() => input.focus(), 50);
});





    //Etsit√§√§n aktiivinen pelaaja
    function getActivePlayerIndex() {
        const players = document.querySelectorAll(".player");
        let activeIndex = 0;

        players.forEach((p, i) => {
            if (p.classList.contains("activePlayer")) {
                activeIndex = i;
            }
        });

        return activeIndex;
    }


    function setActivePlayer(index) {
        document.querySelectorAll(".player").forEach((p, i) => {
            p.classList.toggle("activePlayer", i === index);
        });
        }
        
        function nextPlayer() {
            const players = document.querySelectorAll(".player");
            let current = 0;

            players.forEach((p, i) => {
                if (p.classList.contains("activePlayer")) {
                current = i;
                }
            });

            const next = (current + 1) % players.length;
            setActivePlayer(next);
            }


            // ‚≠ê T√§ytt√§√§ koko taulun (4 rivi√§)
            function fillBoard() {
                const answer = answers[currentTaskIndex].toUpperCase();
                const letters = answer.split("");
                const tiles = document.querySelectorAll(".letterTile");

                tiles.forEach((tile, i) => {
                    const char = letters[i] || "";
                    tile.dataset.letter = char;
                    tile.textContent = ""; // pysyy piilossa kunnes flipataan
                });
            }
      
            
            function fillRow(rowIndex, text) {
                const cells = document.querySelectorAll("#wordGrid .cell");
                const rowStart = rowIndex * 13;
                const totalCells = 13;

                const chars = text.split("");
                const wordLength = chars.length;

                const leftPadding = Math.floor((totalCells - wordLength) / 2);

                // ‚≠ê Nollataan rivi
                for (let i = 0; i < totalCells; i++) {
                    const cell = cells[rowStart + i];
                    const fill = cell.querySelector(".fill");

                    fill.style.backgroundColor = "#3399ff";

                    fill.style.color = "";

                    fill.textContent = "";
                    delete cell.dataset.letter;

                    fill.classList.remove("revealStart", "flip", "revealed");
                }

                // ‚≠ê T√§ytet√§√§n merkit
                /*
                for (let i = 0; i < chars.length; i++) {
                    const cell = cells[rowStart + leftPadding + i];
                    const fill = cell.querySelector(".fill");
                    const ch = chars[i];

                    if (ch === " ") {
                    fill.style.backgroundColor = "#3399ff";
                    fill.textContent = "";
                    delete cell.dataset.letter;

                    } else if (autoRevealChars.includes(ch)) {
                    fill.style.backgroundColor = "white";
                    fill.textContent = ch.toUpperCase();
                    delete cell.dataset.letter;

                    } else {
                    fill.style.backgroundColor = "#777";
                    fill.textContent = "";
                    cell.dataset.letter = ch.toUpperCase();
                    }
                }
                */
               // ‚≠ê T√§ytet√§√§n merkit
                // ‚≠ê T√§ytet√§√§n merkit
                for (let i = 0; i < chars.length; i++) {
                    const cell = cells[rowStart + leftPadding + i];
                    const fill = cell.querySelector(".fill");

                    const ch = chars[i];
                    const normalized = ch.normalize("NFKC");   // ‚≠ê Normalisointi

                    if (normalized === " ") {
                        fill.style.backgroundColor = "#3399ff";
                        fill.textContent = "";
                        delete cell.dataset.letter;

                    } else if (autoRevealChars.includes(normalized)) {   // ‚≠ê Vertailu normalisoidulla merkill√§
                        fill.style.backgroundColor = "white";
                        fill.textContent = normalized;                  // ‚≠ê N√§ytet√§√§n normalisoitu merkki sellaisenaan
                        fill.style.color = "#003366";
                        fill.style.fontWeight = "bold";
                        fill.style.fontSize = "50px";
                        delete cell.dataset.letter;

                    } else {
                        fill.style.backgroundColor = "#777";
                        fill.textContent = "";
                        cell.dataset.letter = normalized.toUpperCase(); // ‚≠ê Tallennetaan normalisoitu versio
                    }
                }



            }

    
    function playFoundDing() {
    const audio = new Audio("ding2.mp3");
    audio.currentTime = 0;
    audio.play();
    }

    function playNotFoundDing() {
    const audio = new Audio("notfound.mp3");
    audio.currentTime = 0;
    audio.play();
    }

    function revealLetter(letter) {
        const cells = document.querySelectorAll("#wordGrid .cell");
        let count = 0;

        const matchingCells = [];

        cells.forEach(cell => {
            if (cell.dataset.letter === letter) {
                matchingCells.push(cell);
            }
        });

        matchingCells.forEach((cell, index) => {
            const fill = cell.querySelector(".fill");
            const flipDuration = 696; // sama kuin CSS

            setTimeout(() => {

                fill.style.color = "";   // ‚≠ê tyhjent√§√§ inline‚Äëv√§rin

                // Aloita flip
                fill.classList.add("flip");

                // Paljasta kirjain flipin puoliv√§liss√§
                setTimeout(() => {
                    fill.textContent = cell.dataset.letter;
                    fill.classList.add("revealed");   // ‚≠ê T√ÑM√Ñ ON KRIITTINEN
                    fill.style.backgroundColor = "white";
                    fill.style.fontFamily = "Arial, sans-serif";
                    fill.style.fontWeight = "bold";
                    fill.style.fontSize = "50px";

                    playFoundDing();
                }, flipDuration / 2);

                // Poista flip-luokka lopuksi
                setTimeout(() => {
                    fill.classList.remove("flip");
                }, flipDuration);

            }, index * flipDuration);

            count++;
        });

        const flipDoneMs = (count - 1) * 696 + 700;

        return { count, flipDoneMs };
}





    
// ‚≠ê OK-nappi (konsonantti + vokaali samalla popupilla)
document.getElementById("popupOkButton").addEventListener("click", () => {
    const popup = document.getElementById("letterPopup");
    const content = document.querySelector(".popupContent");

    popup.classList.add("hidden");
    content.style.pointerEvents = "none";

    const letter = document.getElementById("consonantInput").value.toUpperCase();
    console.log("Valittu kirjain:", letter);

    const vowels = ["A", "E", "I", "O", "U", "Y", "√Ñ", "√ñ"];

    // ============================================================
    // ‚≠ê 1) VOKAALIN OSTO
    // ============================================================
    if (isBuyingVowel === true) {

        if (!vowels.includes(letter)) {
            alert("Vokaalin ostossa voi sy√∂tt√§√§ vain vokaalin!");
            isBuyingVowel = false;
            return;
        }

        const activePlayerIndex = getActivePlayerIndex();
        const scoreElement = document.getElementById(`p${activePlayerIndex + 1}score`);
        const currentScore = parseInt(scoreElement.textContent, 10) || 0;
        scoreElement.textContent = currentScore - 300;

        // ‚≠ê revealLetter palauttaa objektin ‚Üí k√§yt√§ result.count
        const result = revealLetter(letter);

        if (result.count === 0) {
            playNotFoundDing();
            nextPlayer();
            resetWheel();
        }

        isBuyingVowel = false;
        return;
    }

    // ============================================================
    // ‚≠ê 2) KONSONANTIN ARVAUS
    // ============================================================

    if (vowels.includes(letter)) {
        alert("Konsonantin arvauksessa ei voi sy√∂tt√§√§ vokaalia!");
        return;
    }

    const cells = document.querySelectorAll("#wordGrid .cell");
    let alreadyRevealed = false;
    cells.forEach(cell => {
        const fill = cell.querySelector(".fill");
        if (fill.textContent === letter) {
            alreadyRevealed = true;
        }
    });
    if (alreadyRevealed) {
        playNotFoundDing();
        nextPlayer();
        resetWheel();
        return;
    }

    // ‚≠ê revealLetter palauttaa objektin ‚Üí k√§yt√§ result.count
    const result = revealLetter(letter);

    if (result.count === 0) {
        console.log("Kirjainta ei l√∂ytynyt taulusta.");
        playNotFoundDing();
        nextPlayer();
        resetWheel();
        return;
    }

    // ‚≠ê Konsonantti l√∂ytyi ‚Üí pisteet = l√∂ytyneet √ó py√∂r√§n arvo
    const points = result.count * (window.lastSpinValue || 0);
    console.log(`L√∂ytyi ${result.count} kpl ‚Üí +${points} pistett√§`);

    addPointsToActivePlayer(points);
});



        function animateScoreCount(element, start, end) {
            const pointsAdded = end - start;

            // ‚≠ê Animaation kesto riippuu pisteist√§
            // 0.3 sekuntia + 0.001 sekuntia per piste
            let duration = 300 + pointsAdded * 1.0; // 1 ms per piste

            // Rajoitetaan maksimi 1500 ms (1.5 sekuntia)
            if (duration > 3000) duration = 3000;

            const steps = 30; // tasainen rullaus
            const stepTime = duration / steps;

            let current = start;
            const increment = (end - start) / steps;

            const interval = setInterval(() => {
                current += increment;
                element.textContent = Math.round(current);

                if ((increment > 0 && current >= end) ||
                    (increment < 0 && current <= end)) {
                    element.textContent = end;
                    clearInterval(interval);
                }
            }, stepTime);
        }



        function addPointsToActivePlayer(points) {
            const players = document.querySelectorAll(".player");
            let activeIndex = -1;

            // Etsi aktiivinen pelaaja
            players.forEach((p, i) => {
                if (p.classList.contains("activePlayer")) {
                    activeIndex = i;
                }
            });

            if (activeIndex === -1) {
                console.warn("Ei l√∂ytynyt aktiivista pelaajaa!");
                return;
            }

            // Hae oikea pistelaskuri
            const scoreElement = document.getElementById(`p${activeIndex + 1}score`);
            const currentScore = parseInt(scoreElement.textContent, 10) || 0;

            // Laske uusi pistem√§√§r√§
            const newScore = currentScore + points;

            // ‚≠ê P√§ivit√§ pistelaskuri (lopullinen arvo)
            scoreElement.textContent = newScore;

            // ‚≠ê T√ÑH√ÑN KOHTAAN TULEE NUMEROANIMAATIO
            animateScoreCount(scoreElement, currentScore, newScore);

            const pointsAdded = newScore - currentScore;
            let duration = 300 + pointsAdded * 1.0 + 2500;
            if (duration > 4000) duration = 4000;

            animateScoreCount(scoreElement, currentScore, newScore);

            setTimeout(() => {
                resetWheel();
            }, duration);


            console.log(`Pelaaja ${activeIndex + 1} sai ${points} pistett√§ ‚Üí uusi pistem√§√§r√§: ${newScore}`);
        }




    const spinSound = new Audio("spin.mp3");
    spinSound.volume = 0.7;
    
    const dingSound = new Audio("ding.mp3");
    dingSound.volume = 0.8;
    
    const rosvoSound = new Audio("rosvosektori.mp3");
    rosvoSound.volume = 0.8;
    
    const ohiSound = new Audio("ohisektori.mp3");
    ohiSound.volume = 0.8;

    const taskvictorySound = new Audio("taskvictory.mp3");
    taskvictorySound.volume = 0.9;

    const victorySound = new Audio("victory.mp3");
    victorySound.volume = 0.9;

    
    let currentIndex = 2;
    const totalPositions = 72;
    const degreesPerStep = 360 / totalPositions;
    
    // T√§sm√§lleen oikea 72-alkioinen taulukko
    const wheel72 = [
      "Ohi", "Ohi", 1350,
      1350, 1350, 950,
      950, 950, 450,
      450, 450, 850,
      850, 850, 350,
      350, 350, "Rosvo",
      "Rosvo", "Rosvo", 500,
      500, 500, 650,
      650, 650, 300,
      300, 300, 200,
      200, 200, 700,
      700, 700, "Rosvo",
      "Rosvo", "Rosvo", 250,
      250, 250, 400,
      400, 400, "Ohi",
      "Ohi", "Ohi", 750,
      750, 750, 1600,
      1600, 1600, "Ohi",
      "Ohi", "Ohi", 1300,
      1300, 1300, 800,
      800, 800, "Ohi",
      "Ohi", "Ohi", 600,
      600, 600, 900,
      900, 900, "Ohi"
    ];
    
    document.getElementById("spinButton").addEventListener("click", spinWheel);
    
    function spinWheel() {
      const wheel = document.getElementById("wheelImage");
      const popup = document.getElementById("letterPopup");
      const content = document.querySelector(".popupContent");
    
      wheel.classList.remove("spin-animation");
    
      spinSound.currentTime = 0;
      spinSound.play();
    
      const randomSteps = Math.floor(Math.random() * totalPositions);
      const targetIndex = (currentIndex + randomSteps) % totalPositions;
    
      const fullRotations = 360 * 5;
      const finalRotation = fullRotations + targetIndex * degreesPerStep;
    
      setTimeout(() => {
        wheel.classList.add("spin-animation");
        wheel.style.transform = `rotate(${finalRotation}deg)`;
      }, 20);
    
      currentIndex = targetIndex;
    
      setTimeout(() => {
        spinSound.pause();
        spinSound.currentTime = 0;
    
        // ‚≠ê KORJAUS: py√∂r√§n kuva py√∂rii vastakkaiseen suuntaan
        const pointerIndex = (totalPositions - targetIndex) % totalPositions;
        const result = wheel72[pointerIndex];

        // ‚≠ê Tallenna viimeisin pistem√§√§r√§ globaaliin muuttujaan
        if (typeof result === "number") {
            window.lastSpinValue = result;
        } else {
            window.lastSpinValue = 0; // Rosvo tai Ohi
        }

    
        const spinAngle = (pointerIndex * degreesPerStep) % 360;
    
        console.log(
          "Raw index:", targetIndex,
          "‚Üí Pointer index:", pointerIndex,
          "‚Üí Arvo:", result,
          "‚Üí Kulma:", spinAngle
        );
    
        //document.getElementById("debugPoints").textContent =
        //  "Index: " + pointerIndex +
        //  " | Arvo: " + result +
        //  " | Kulma: " + spinAngle.toFixed(1) + "¬∞";
    
        if (result === "Rosvo") {
          rosvoSound.play();

          // ‚≠ê Nollaa aktiivisen pelaajan pisteet
          const activePlayerIndex = getActivePlayerIndex();
          const scoreElement = document.getElementById(`p${activePlayerIndex + 1}score`);
          scoreElement.textContent = 0;

          // ‚≠ê Pieni viive ennen vuoronvaihtoa ja resetti√§ 
          setTimeout(() => { 
                nextPlayer(); 
                resetWheel(); 
            }, 3000);

        } 
        else if (result === "Ohi") {
          ohiSound.play();
          // ‚≠ê Pieni viive ennen vuoronvaihtoa ja resetti√§ 
          setTimeout(() => { 
                nextPlayer(); 
                resetWheel(); 
            }, 1500);

        } 
        else {
            // ‚≠ê √Ñl√§ soita ding-√§√§nt√§, jos ollaan ostamassa vokaalia
            if (!isBuyingVowel) {
                dingSound.play();
            }

    
          // ‚≠ê T√ÑRKE√Ñ: asetetaan tila takaisin konsonanttimoodiin 
          isBuyingVowel = false;

          popup.classList.remove("hidden");
          document.getElementById("popupTitle").textContent = "KONSONANTTI";

          popup.style.display = "flex";
          content.style.pointerEvents = "auto";
    
          content.style.animation = "none";
          content.offsetHeight;
          content.style.animation = "popupGrow 0.35s ease-out forwards";
    
          const input = document.getElementById("consonantInput");
          input.value = "";
          setTimeout(() => input.focus(), 50);
        }
    
      }, 2000);
    }
    
    document.getElementById("consonantInput").addEventListener("input", (e) => {
        let v = e.target.value.toUpperCase();
        const vowels = "AEIOUY√Ö√Ñ√ñ";

        if (!/^[A-Z√Ö√Ñ√ñ]$/.test(v)) {
            e.target.value = "";
            return;
        }

        if (isBuyingVowel) {
            if (!vowels.includes(v)) {
                e.target.value = "";
            }
            return;
        }

        if (vowels.includes(v)) {
            e.target.value = "";
        }
    });



    
    function resetWheel() {
    const wheel = document.getElementById("wheelImage");
    const spinButton = document.getElementById("spinButton");

    if (!wheel) {
        console.warn("resetWheel: #wheelImage elementti√§ ei l√∂ytynyt!");
        return;
    }

    // Poista kaikki mahdolliset py√∂rimisluokat
    wheel.classList.remove("spin-animation", "spinning", "rotate");

    // Palauta py√∂r√§ alkuasentoon
    wheel.style.transition = "none";        // est√§√§ animaation resetiss√§
    wheel.style.transform = "rotate(0deg)";

    // Pieni viive, jotta seuraava py√∂ritys toimii
    setTimeout(() => {
        wheel.style.transition = "";        // palautetaan normaali animaatio
    }, 50);

    // Aktivoi spin-nappi
    spinButton.disabled = false;
    spinButton.classList.remove("disabled");

    console.log("Onnenpy√∂r√§ alustettu seuraavaa pelaajaa varten.");
}

        document.getElementById("solveButton").addEventListener("click", () => {

            const activeIndex = getActivePlayerIndex();

            // Flipataan kaikki kirjaimet JA soitetaan dingit oikealla rytmill√§
            const result = revealWholeBoardAnimated(true);

            const playerEls = document.querySelectorAll("#playerBar .player");
            const activePlayerEl = playerEls[activeIndex];

            // Soita fanfaari
            taskvictorySound.currentTime = 0;
            taskvictorySound.play();

            setTimeout(() => {

                // ‚≠ê Kultainen pulssi alkaa
                activePlayerEl.classList.add("winGold");

                setTimeout(() => {

                    // ‚≠ê‚≠ê PISTEIDEN SIIRTO TAPAHTUU T√ÑSS√Ñ HETKESS√Ñ ‚≠ê‚≠ê
                    const roundScore = parseInt(document.getElementById(`p${activeIndex+1}score`).textContent) || 0;

                    if (roundScore > 0) {
                        totalScores[activeIndex] += roundScore;
                        updateTotalScores();
                    }

                    // ‚≠ê Pulssi loppuu
                    activePlayerEl.classList.remove("winGold");

                    // ‚≠ê‚≠ê Siirryt√§√§n seuraavaan teht√§v√§√§n
                    currentTaskIndex++;

                    // ‚≠ê Jos kaikki 3 teht√§v√§√§ tehty ‚Üí n√§yt√§ voittoruudun 
                    if (currentTaskIndex >= 3) { 
                        showVictoryScreen(); 
                        return; 
                    }

                    setActivePlayerForTask();
                    startNewTask();

                }, 11000);

            }, result.flipDoneMs + 200);

        });








    function revealWholeBoard() {
        const cells = document.querySelectorAll("#wordGrid .cell");

            cells.forEach(cell => {
            const fill = cell.querySelector(".fill");
            const letter = cell.dataset.letter;

            // Jos solussa ei ole piilotettua kirjainta ‚Üí ohitetaan
            if (!letter) return;

            // Poistetaan flip-animaation vanhat luokat
            fill.classList.remove("revealStart", "flip");

            // Paljastetaan kirjain
            fill.style.backgroundColor = "white";
            fill.style.color = "#003366";
            fill.textContent = letter;

            fill.style.fontFamily = "Arial, sans-serif";
            fill.style.fontWeight = "bold";
            fill.style.fontSize = "50px";
        });
    }

    function revealWholeBoardAnimated(playSound = true) {
    const cells = document.querySelectorAll("#wordGrid .cell");
    const letterCells = [];
    const flipDuration = 696; // sama kuin revealLetteriss√§

    // Ker√§√§ paljastamattomat kirjainsolut listaan
    cells.forEach(cell => {
        const letter = cell.dataset.letter;
        const fill = cell.querySelector(".fill");

        if (letter && letter.trim() !== "" && fill.textContent.trim() === "") {
            letterCells.push(cell);
        }
    });

    // Flipataan kirjaimet YKSI KERRALLAAN kuten revealLetter
    letterCells.forEach((cell, index) => {
        const fill = cell.querySelector(".fill");
        const letter = cell.dataset.letter;

        // ‚≠ê Flip alkaa vasta kun edellinen on valmis
        setTimeout(() => {

            // Poista inline-v√§ri
            fill.style.color = "";

            // Aloita flip
            fill.classList.add("flip");

            // ‚≠ê Flipin puoliv√§liss√§ paljastetaan kirjain + √§√§ni
            setTimeout(() => {
                fill.textContent = letter;
                fill.classList.add("revealed");
                fill.style.backgroundColor = "white";

                fill.style.fontFamily = "Arial, sans-serif";
                fill.style.fontWeight = "bold";
                fill.style.fontSize = "50px";

                if (playSound) playFoundDing();

            }, flipDuration / 2);

            // ‚≠ê Flip loppuu
            setTimeout(() => {
                fill.classList.remove("flip");
            }, flipDuration);

        }, index * flipDuration); // ‚≠ê T√§m√§ pit√§√§ flipit per√§kk√§isin√§
    });

    const flipDoneMs =
        letterCells.length > 0
            ? (letterCells.length - 1) * flipDuration + flipDuration
            : 0;

    return { flipDoneMs, letterCells };
}





function launchConfetti() {
    const duration = 2500;
    const end = Date.now() + duration;

    (function frame() {
        for (let i = 0; i < 20; i++) {
            const confetti = document.createElement("div");
            confetti.className = "confettiPiece";

            confetti.style.backgroundColor =
                `hsl(${Math.floor(Math.random() * 360)}, 80%, 60%)`;

            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.animationDuration = (1 + Math.random() * 2) + "s";

            document.body.appendChild(confetti);

            setTimeout(() => confetti.remove(), 3000);
        }

        if (Date.now() < end) {
            requestAnimationFrame(frame);
        }
    })();
}


    function showVictoryScreen() {
        const screen = document.getElementById("victoryScreen");

        // ‚≠ê Rakennetaan lista pelaajista ja pisteist√§
        const results = players.map((name, i) => ({
            name: name.toUpperCase(),
            score: totalScores[i]
        }));

        // ‚≠ê Lajitellaan pisteiden mukaan (suurin ensin)
        results.sort((a, b) => b.score - a.score);

        // ‚≠ê Asetetaan korokkeille
        const first  = results[0]; // keskikoroke
        const second = results[1]; // vasen
        const third  = results[2]; // oikea

        // ‚≠ê P√§ivitet√§√§n UI
        document.getElementById("podiumFirstName").textContent  = first.name;
        document.getElementById("podiumFirstScore").textContent = first.score + " pistett√§";

        document.getElementById("podiumSecondName").textContent  = second.name;
        document.getElementById("podiumSecondScore").textContent = second.score + " pistett√§";

        document.getElementById("podiumThirdName").textContent  = third.name;
        document.getElementById("podiumThirdScore").textContent = third.score + " pistett√§";

        // ‚≠ê N√§yt√§ voittoruutu
        screen.classList.remove("hidden");

        // ‚≠ê Soita fanfaari
        victorySound.currentTime = 0;
        victorySound.play();

        // ‚≠ê K√§ynnist√§ konfetti
        setTimeout(() => {
            launchConfetti();
        }, 100);
    }


function updateTotalScores() {
    const els = document.querySelectorAll(".playerTotalScore");
    els.forEach((el, i) => {
        el.textContent = totalScores[i] > 0 ? totalScores[i] : "";
    });

    // ‚≠ê Nollaa teht√§v√§pisteet seuraavaa teht√§v√§√§ varten
    resetRoundScores();
}


function resetRoundScores() {
    const scoreEls = document.querySelectorAll(".playerScore");
    scoreEls.forEach(el => {
        el.textContent = "0";
    });
}


function setActivePlayerForTask() {
    const players = document.querySelectorAll("#playerBar .player");

    // Poista vanha aktiivisuus
    players.forEach(p => p.classList.remove("activePlayer"));

    // Aseta uusi aktiivinen pelaaja
    const newActive = players[currentTaskIndex];
    if (newActive) {
        newActive.classList.add("activePlayer");
    }
}

function resetBoard() {
    const cells = document.querySelectorAll("#wordGrid .cell");

    cells.forEach(cell => {
        const fill = cell.querySelector(".fill");

        fill.textContent = "";
        fill.style.backgroundColor = "#3399ff";
        fill.style.color = "";
        fill.classList.remove("revealStart", "flip", "revealed");

        delete cell.dataset.letter;
    });
}


function startNewTask() {
    resetBoard();

    // ‚≠ê Aihe
    document.getElementById("topicTitle").textContent =
        topics[currentTaskIndex].toUpperCase();

    // ‚≠ê Haetaan vastaus ja jaetaan rivit
    const lines = answers[currentTaskIndex]
        .toUpperCase()
        .split("\n")        // tukee 1‚Äì4 rivi√§
        .slice(0, 4);       // varmistetaan max 4 rivi√§

    // ‚≠ê T√§ytet√§√§n rivit
    lines.forEach((line, i) => {
        fillRow(i, line);
    });
}



    </script>
    


</body>
</html>
